"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[6509],{46509:(b,h,s)=>{s.r(h),s.d(h,{DfSchedulerDetailsComponent:()=>O});var m,o=s(97582),a=s(56223),c=s(62651),p=s(35326),d=s(86806),T=s(42346),g=s(96814),f=s(74104),E=s(2032),l=s(98525),_=s(82599),i=s(32296),v=s(41609),D=s(75058),y=s(78791),Z=s(41089),C=s(26306),A=s(58504),e=s(65879),P=s(81896),M=s(64170),I=s(23680);function L(n,r){if(1&n&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function S(n,r){if(1&n&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function U(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",4)(1,"mat-label"),e._uU(2),e.ALo(3,"transloco"),e.qZA(),e.TgZ(4,"mat-select",23),e.YNc(5,S,2,2,"mat-option",10),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"scheduler.form.label.component")),e.xp6(3),e.Q6J("ngForOf",t.componentDropdownOptions)}}function B(n,r){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",4)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e._UZ(5,"textarea",24),e.qZA(),e.BQk()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"scheduler.form.label.payload")))}s(6625);const x=function(n){return{label:n}};let O=((m=class{constructor(r,t,u,R,K){this.service=r,this.formBuilder=t,this.activatedRoute=u,this.router=R,this.accessListService=K,this.relatedParam="task_log_by_task_id",this.componentDropdownOptions=[],this.log="",this.alertMsg="",this.showAlert=!1,this.alertType="error"}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",a.kI.required],description:[""],active:[!0,a.kI.required],serviceId:["",a.kI.required],component:["",a.kI.required],method:["GET",a.kI.required],frequency:[]}),this.activatedRoute.data.subscribe(r=>{this.userServicesDropdownOptions=r.data.resource}),this.activatedRoute.data.subscribe(r=>{this.scheduleToEdit=r.schedulerObject,this.scheduleToEdit&&(this.log=this.scheduleToEdit.taskLogByTaskId?.content??"",this.getServiceAccessList(this.scheduleToEdit.serviceId),this.formGroup.setValue({name:this.scheduleToEdit.name,description:this.scheduleToEdit.description,active:this.scheduleToEdit.isActive,serviceId:this.scheduleToEdit.serviceId,component:this.scheduleToEdit.component,method:this.scheduleToEdit.verb,frequency:this.scheduleToEdit.frequency}),"GET"!==this.scheduleToEdit.verb&&this.addPayloadField(this.scheduleToEdit.payload))}),this.formGroup.get("method")?.valueChanges.subscribe(r=>{"GET"===r?this.removePayloadField():this.formGroup.contains("payload")||this.addPayloadField()}),this.formGroup.get("serviceId")?.valueChanges.subscribe(r=>{this.getServiceAccessList(r)})}triggerAlert(r,t){this.alertType=r,this.alertMsg=t,this.showAlert=!0}onCancel(){this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER])}onSubmit(){if(!this.formGroup.invalid&&!this.formGroup.pristine)if(typeof this.scheduleToEdit>"u"){const r=this.assemblePayload();this.service.create({resource:[r]},{snackbarSuccess:"scheduler.alerts.createdSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.K)(t=>(this.triggerAlert("error",t.error.error.context.resource[0].message),(0,A._)(()=>new Error(t))))).subscribe(()=>this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER]))}else if(this.scheduleToEdit){const r=this.assemblePayload();this.service.update(this.scheduleToEdit.id,r,{snackbarSuccess:"scheduler.alerts.updateSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.K)(t=>(this.triggerAlert("error",t.error.error.message),(0,A._)(()=>new Error(t))))).subscribe(()=>this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER]))}}addPayloadField(r){this.formGroup.addControl("payload",this.formBuilder.control(r??"",[p.U]))}removePayloadField(){this.formGroup.removeControl("payload")}getServiceAccessList(r){const t=this.userServicesDropdownOptions.find(u=>u.id===r);this.selectedService=t,t&&this.accessListService.get(t.name,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(u=>{this.componentDropdownOptions=u.resource})}getVerbMask(r){switch(r){case"GET":default:return 1;case"POST":return 2;case"PUT":return 4;case"PATCH":return 8;case"DELETE":return 16}}assemblePayload(){if(this.selectedService){const r={component:this.formGroup.value.component,description:this.formGroup.value.description,frequency:this.formGroup.value.frequency,isActive:this.formGroup.value.active,name:this.formGroup.value.name,payload:this.formGroup.value.payload??null,serviceId:this.formGroup.value.serviceId,serviceName:this.selectedService.name,verb:this.formGroup.value.method,service:{id:this.formGroup.value.serviceId,name:this.selectedService.name,label:this.selectedService.label,description:this.selectedService.description,type:this.selectedService.type,components:this.componentDropdownOptions},verbMask:this.getVerbMask(this.formGroup.value.method)};return this.scheduleToEdit?{lastModifiedDate:this.scheduleToEdit.lastModifiedDate,lastModifiedById:this.scheduleToEdit.lastModifiedById,hasLog:!!this.scheduleToEdit.taskLogByTaskId,createdDate:this.scheduleToEdit.createdDate,createdById:this.scheduleToEdit.createdById,id:this.scheduleToEdit.id,...r}:{...r,id:null}}return null}}).\u0275fac=function(r){return new(r||m)(e.Y36(d.bi),e.Y36(a.qu),e.Y36(P.gz),e.Y36(P.F0),e.Y36(d.PA))},m.\u0275cmp=e.Xpm({type:m,selectors:[["df-scheduler"]],standalone:!0,features:[e.jDz],decls:52,vars:45,consts:[[3,"showAlert","alertType","alertClosed"],["dynamicHeight","","mat-stretch-tabs","false","mat-align-tabs","start"],["label","Basic"],[1,"details-section",3,"formGroup","ngSubmit"],["subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","placeholder","Name","formControlName","name"],["formControlName","active",1,"dynamic-width"],["subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","placeholder","Description","formControlName","description"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic","class","dynamic-width",4,"ngIf"],["matInput","","type","number","formControlName","frequency"],[4,"ngIf"],["formControlName","method",1,"dynamic-width",3,"schema"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",3,"click"],["mat-flat-button","","color","primary"],["label","Log"],[1,"details-section"],[1,"full-width",3,"readonly","value"],["type","button","mat-flat-button","","color","primary",3,"click"],[3,"value"],["formControlName","component"],["rows","1","matInput","","formControlName","payload"]],template:function(r,t){1&r&&(e.TgZ(0,"df-alert",0),e.NdJ("alertClosed",function(){return t.showAlert=!1}),e._uU(1),e.qZA(),e.TgZ(2,"mat-tab-group",1)(3,"mat-tab",2)(4,"h4"),e._uU(5),e.ALo(6,"transloco"),e.qZA(),e.TgZ(7,"form",3),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(8,"mat-form-field",4)(9,"mat-label"),e._uU(10),e.ALo(11,"transloco"),e.qZA(),e._UZ(12,"input",5),e.qZA(),e.TgZ(13,"mat-slide-toggle",6),e._uU(14),e.ALo(15,"transloco"),e.qZA(),e.TgZ(16,"mat-form-field",7)(17,"mat-label"),e._uU(18),e.ALo(19,"transloco"),e.qZA(),e._UZ(20,"textarea",8),e.qZA(),e.TgZ(21,"mat-form-field",4)(22,"mat-label"),e._uU(23),e.ALo(24,"transloco"),e.qZA(),e.TgZ(25,"mat-select",9),e.YNc(26,L,2,2,"mat-option",10),e.qZA()(),e.YNc(27,U,6,4,"mat-form-field",11),e.TgZ(28,"mat-form-field",4)(29,"mat-label"),e._uU(30),e.ALo(31,"transloco"),e.qZA(),e._UZ(32,"input",12),e.qZA(),e.YNc(33,B,6,3,"ng-container",13),e._UZ(34,"df-verb-picker",14),e.ALo(35,"transloco"),e.TgZ(36,"div",15)(37,"button",16),e.NdJ("click",function(){return t.onCancel()}),e._uU(38),e.ALo(39,"transloco"),e.qZA(),e.TgZ(40,"button",17),e._uU(41),e.ALo(42,"transloco"),e.qZA()()()(),e.TgZ(43,"mat-tab",18)(44,"div",19)(45,"p"),e._uU(46),e.ALo(47,"transloco"),e.qZA(),e._UZ(48,"df-ace-editor",20),e.TgZ(49,"button",21),e.NdJ("click",function(){return t.onCancel()}),e._uU(50),e.ALo(51,"transloco"),e.qZA()()()()),2&r&&(e.Q6J("showAlert",t.showAlert)("alertType",t.alertType),e.xp6(1),e.hij(" ",t.alertMsg,"\n"),e.xp6(4),e.Oqu(e.lcZ(6,21,"scheduler.taskOverviewSubtitle")),e.xp6(2),e.Q6J("formGroup",t.formGroup),e.xp6(3),e.Oqu(e.lcZ(11,23,"scheduler.form.label.name")),e.xp6(4),e.Oqu(e.lcZ(15,25,"scheduler.form.label.active")),e.xp6(4),e.Oqu(e.lcZ(19,27,"scheduler.form.label.description")),e.xp6(5),e.Oqu(e.lcZ(24,29,"scheduler.form.label.service")),e.xp6(3),e.Q6J("ngForOf",t.userServicesDropdownOptions),e.xp6(1),e.Q6J("ngIf",t.componentDropdownOptions.length),e.xp6(3),e.Oqu(e.lcZ(31,31,"scheduler.form.label.frequency")),e.xp6(3),e.Q6J("ngIf",t.formGroup.controls.payload),e.xp6(1),e.Q6J("schema",e.VKq(43,x,e.lcZ(35,33,"scheduler.form.label.method"))),e.xp6(4),e.hij(" ",e.lcZ(39,35,"cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(42,37,"save")," "),e.xp6(5),e.AsE(" ",e.lcZ(47,39,"scheduler.logs.statusCode"),": ",null==t.scheduleToEdit||null==t.scheduleToEdit.taskLogByTaskId?null:t.scheduleToEdit.taskLogByTaskId.statusCode," "),e.xp6(2),e.Q6J("readonly",!0)("value",t.log),e.xp6(2),e.hij(" ",e.lcZ(51,41,"goBack")," "))},dependencies:[i.ot,i.lW,E.c,E.Nt,M.KE,M.hX,f.Nh,f.uX,f.SP,l.LD,l.gD,I.ey,_.rP,_.Rr,g.O5,g.ax,T.Ot,a.UX,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,v.C,D.M,Z.v],encapsulation:2}),m);O=(0,o.gn)([(0,y.c)({checkProperties:!0})],O)},41089:(b,h,s)=>{s.d(h,{v:()=>E});var o=s(65879),a=s(96814),c=s(32296),p=s(45597),d=s(90590);function T(l,_){if(1&l){const i=o.EpF();o.TgZ(0,"button",5),o.NdJ("click",function(){o.CHM(i);const D=o.oxw(2);return o.KtG(D.dismissAlert())}),o.TgZ(1,"fa-icon",6),o._uU(2),o.qZA()()}if(2&l){const i=o.oxw(2);o.xp6(1),o.Q6J("icon",i.faXmark),o.xp6(1),o.Oqu("alerts.close")}}function g(l,_){if(1&l&&(o.TgZ(0,"div",1),o._UZ(1,"fa-icon",2),o.TgZ(2,"span",3),o.Hsn(3),o.qZA(),o.YNc(4,T,3,2,"button",4),o.qZA()),2&l){const i=o.oxw();o.Tol(i.alertType),o.xp6(1),o.Q6J("icon",i.icon),o.xp6(3),o.Q6J("ngIf",i.dismissible)}}const f=["*"];let E=(()=>{class l{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new o.vpe,this.faXmark=d.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return d.f8k;case"error":return d.$9F;case"warning":return d.RLE;default:return d.sqG}}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=o.Xpm({type:l,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[o.jDz],ngContentSelectors:f,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(i,v){1&i&&(o.F$t(),o.YNc(0,g,5,4,"div",0)),2&i&&o.Q6J("ngIf",v.showAlert)},dependencies:[a.O5,c.ot,c.RK,p.uH,p.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),l})()}}]);