"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[3517],{73517:(E,_,r)=>{r.r(_),r.d(_,{DfLimitDetailsComponent:()=>C});var d,o=r(97582),n=r(56223),u=r(26306),p=r(58504),c=r(32296),f=r(82599),h=r(23680),v=r(96814),g=r(98525),l=r(2032),m=r(64170),a=r(41089),T=r(86806),A=r(42346),O=r(75058),y=r(78791),t=r(65879),D=r(81896);function I(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function P(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",30),t.YNc(6,I,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.service")),t.xp6(3),t.Q6J("ngForOf",i.serviceDropdownOptions)}}function M(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function L(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",33),t.YNc(6,M,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.role")),t.xp6(3),t.Q6J("ngForOf",i.roleDropdownOptions)}}function x(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function b(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",34),t.YNc(6,x,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.user")),t.xp6(3),t.Q6J("ngForOf",i.userDropdownOptions)}}function U(s,e){1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",35),t.qZA(),t.BQk()),2&s&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"limits.endpoint")))}r(6625);const B=function(s,e){return{label:s,description:e}};let C=((d=class{constructor(e,i,Z,G,q){this.limitService=e,this.router=i,this.activatedRoute=Z,this.translateService=G,this.formBuilder=q,this.isEditMode=!1,this.limitTypeToEdit=null,this.roleDropdownOptions=[],this.userDropdownOptions=[],this.serviceDropdownOptions=[],this.alertMsg="",this.showAlert=!1,this.alertType="error",this.type="create",this.formGroup=this.formBuilder.group({limitName:["",n.kI.required],description:[""],limitType:["instance",n.kI.required],serviceId:[],roleId:[],userId:[],endpoint:[],limitRate:[null,n.kI.required],limitPeriod:["minute",n.kI.required],verb:[],active:[!0]})}ngOnInit(){this.activatedRoute.data.subscribe(e=>{this.type=e.type,"edit"===e.type&&(this.limitTypeToEdit=e.data,this.formGroup.patchValue({limitName:this.limitTypeToEdit.name,limitType:this.limitTypeToEdit.type,serviceId:this.limitTypeToEdit.serviceId,roleId:this.limitTypeToEdit.roleId,userId:this.limitTypeToEdit.userId,limitRate:this.limitTypeToEdit.rate,limitPeriod:this.limitTypeToEdit.period,active:this.limitTypeToEdit.isActive,description:this.limitTypeToEdit.description,endpoint:this.limitTypeToEdit.endpoint,verb:this.limitTypeToEdit.verb}),this.formGroup.value.serviceId||this.removeFormField("serviceId"),this.formGroup.value.roleId||this.removeFormField("roleId"),this.formGroup.value.userId||this.removeFormField("userId"),this.formGroup.value.endpoint||this.removeFormField("endpoint"))}),"create"===this.type&&(this.removeFormField(),this.renderCorrectHiddenFields("instance")),this.activatedRoute.data.subscribe(e=>{this.serviceDropdownOptions=e.services.resource}),this.activatedRoute.data.subscribe(e=>{this.userDropdownOptions=e.users.resource}),this.activatedRoute.data.subscribe(e=>{this.roleDropdownOptions=e.roles.resource}),this.formGroup.get("limitType")?.valueChanges.subscribe(e=>{e&&(this.removeFormField(),this.renderCorrectHiddenFields(e))})}onSubmit(){if(this.formGroup.valid){if(this.showAlert=!1,"create"===this.type){const e=this.assembleLimitPayload();this.limitService.create({resource:[e]}).pipe((0,u.K)(i=>(this.alertMsg=i.error.error.message,this.showAlert=!0,(0,p._)(()=>new Error(i))))).subscribe(i=>{this.router.navigate(["../",i.resource[0].id],{relativeTo:this.activatedRoute})})}else if("edit"===this.type){const e=this.assembleLimitPayload();this.limitService.update(e.id,e).pipe((0,u.K)(i=>(this.alertMsg=i.error.error.message,this.showAlert=!0,(0,p._)(()=>new Error(i))))).subscribe(i=>{this.router.navigate(["../",i.id],{relativeTo:this.activatedRoute})})}}else this.alertMsg=this.translateService.translate("limits.invalidForm"),this.showAlert=!0}onCancel(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}assembleLimitPayload(){const e={description:this.formGroup.value.description??null,endpoint:this.formGroup.value.endpoint??null,isActive:this.formGroup.value.active,name:this.formGroup.value.limitName,period:this.formGroup.value.limitPeriod,roleId:this.formGroup.value.roleId??null,serviceId:this.formGroup.value.serviceId??null,userId:this.formGroup.value.userId??null,type:this.formGroup.value.limitType,verb:this.formGroup.value.verb};return"edit"===this.type?{id:this.limitTypeToEdit?.id,createdDate:this.limitTypeToEdit?.createdDate,lastModifiedDate:this.limitTypeToEdit?.lastModifiedDate,rate:this.formGroup.value.limitRate??null,...e}:{cacheData:{},rate:this.formGroup.value.limitRate?this.formGroup.value.limitRate.toString():"1",...e}}renderCorrectHiddenFields(e){switch(e){case"instance":case"instance.each_user":break;case"instance.user.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required]));break;case"instance.each_user.service":case"instance.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required]));break;case"instance.role":this.formGroup.addControl("roleId",this.formBuilder.control("",[n.kI.required]));break;case"instance.user":this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required]));break;case"instance.user.service.endpoint":this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.kI.required]));break;case"instance.service.endpoint":case"instance.each_user.service.endpoint":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.kI.required]));break;default:this.removeFormField()}}removeFormField(e){e?this.formGroup.removeControl(e):(this.formGroup.removeControl("serviceId"),this.formGroup.removeControl("roleId"),this.formGroup.removeControl("userId"),this.formGroup.removeControl("endpoint"))}}).\u0275fac=function(e){return new(e||d)(t.Y36(T.xQ),t.Y36(D.F0),t.Y36(D.gz),t.Y36(A.Vn),t.Y36(n.qu))},d.\u0275cmp=t.Xpm({type:d,selectors:[["df-limit"]],standalone:!0,features:[t.jDz],decls:91,vars:85,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","type","text","formControlName","limitName"],["formControlName","verb",1,"dynamic-width",3,"schema"],["subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","type","text","formControlName","description"],["formControlName","limitType"],["value","instance"],["value","instance.user"],["value","instance.each_user"],["value","instance.service"],["value","instance.role"],["value","instance.user.service"],["value","instance.each_user.service"],["value","instance.service.endpoint"],["value","instance.user.service.endpoint"],["value","instance.each_user.service.endpoint"],[4,"ngIf"],["matInput","","type","number","formControlName","limitRate"],["formControlName","limitPeriod"],["value","minute"],["value","hour"],["value","day"],["value","7-day"],["value","30-day"],["formControlName","active",1,"full-width"],[1,"full-width","action-bar"],["type","button","mat-flat-button","",3,"click"],["mat-flat-button","","color","primary"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","roleId"],["formControlName","userId"],["matInput","","type","text","formControlName","endpoint"]],template:function(e,i){1&e&&(t.TgZ(0,"df-alert",0),t.NdJ("alertClosed",function(){return i.showAlert=!1}),t._uU(1),t.qZA(),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(3,"mat-form-field",2)(4,"mat-label"),t._uU(5),t.ALo(6,"transloco"),t.qZA(),t._UZ(7,"input",3),t.qZA(),t._UZ(8,"df-verb-picker",4),t.ALo(9,"transloco"),t.ALo(10,"transloco"),t.TgZ(11,"mat-form-field",5)(12,"mat-label"),t._uU(13),t.ALo(14,"transloco"),t.qZA(),t._UZ(15,"textarea",6),t.qZA(),t.TgZ(16,"mat-form-field",2)(17,"mat-label"),t._uU(18),t.ALo(19,"transloco"),t.qZA(),t.TgZ(20,"mat-select",7)(21,"mat-option",8),t._uU(22),t.ALo(23,"transloco"),t.qZA(),t.TgZ(24,"mat-option",9),t._uU(25),t.ALo(26,"transloco"),t.qZA(),t.TgZ(27,"mat-option",10),t._uU(28),t.ALo(29,"transloco"),t.qZA(),t.TgZ(30,"mat-option",11),t._uU(31),t.ALo(32,"transloco"),t.qZA(),t.TgZ(33,"mat-option",12),t._uU(34),t.ALo(35,"transloco"),t.qZA(),t.TgZ(36,"mat-option",13),t._uU(37),t.ALo(38,"transloco"),t.qZA(),t.TgZ(39,"mat-option",14),t._uU(40),t.ALo(41,"transloco"),t.qZA(),t.TgZ(42,"mat-option",15),t._uU(43),t.ALo(44,"transloco"),t.qZA(),t.TgZ(45,"mat-option",16),t._uU(46),t.ALo(47,"transloco"),t.qZA(),t.TgZ(48,"mat-option",17),t._uU(49),t.ALo(50,"transloco"),t.qZA()()(),t.YNc(51,P,7,4,"ng-container",18),t.YNc(52,L,7,4,"ng-container",18),t.YNc(53,b,7,4,"ng-container",18),t.YNc(54,U,6,3,"ng-container",18),t.TgZ(55,"mat-form-field",2)(56,"mat-label"),t._uU(57),t.ALo(58,"transloco"),t.qZA(),t._UZ(59,"input",19),t.qZA(),t.TgZ(60,"mat-form-field",2)(61,"mat-label"),t._uU(62),t.ALo(63,"transloco"),t.qZA(),t.TgZ(64,"mat-select",20)(65,"mat-option",21),t._uU(66),t.ALo(67,"transloco"),t.qZA(),t.TgZ(68,"mat-option",22),t._uU(69),t.ALo(70,"transloco"),t.qZA(),t.TgZ(71,"mat-option",23),t._uU(72),t.ALo(73,"transloco"),t.qZA(),t.TgZ(74,"mat-option",24),t._uU(75),t.ALo(76,"transloco"),t.qZA(),t.TgZ(77,"mat-option",25),t._uU(78),t.ALo(79,"transloco"),t.qZA()()(),t.ynx(80),t.TgZ(81,"mat-slide-toggle",26),t._uU(82),t.ALo(83,"transloco"),t.qZA(),t.BQk(),t.TgZ(84,"div",27)(85,"button",28),t.NdJ("click",function(){return i.onCancel()}),t._uU(86),t.ALo(87,"transloco"),t.qZA(),t.TgZ(88,"button",29),t._uU(89),t.ALo(90,"transloco"),t.qZA()()()),2&e&&(t.Q6J("showAlert",i.showAlert)("alertType",i.alertType),t.xp6(1),t.Oqu(i.alertMsg),t.xp6(1),t.Q6J("formGroup",i.formGroup),t.xp6(3),t.Oqu(t.lcZ(6,32,"limits.name")),t.xp6(3),t.Q6J("schema",t.WLB(82,B,t.lcZ(9,34,"limits.verb"),t.lcZ(10,36,"limits.verbTooltip"))),t.xp6(5),t.Oqu(t.lcZ(14,38,"limits.description")),t.xp6(5),t.Oqu(t.lcZ(19,40,"limits.limitType")),t.xp6(4),t.hij("",t.lcZ(23,42,"limits.limitTypes.instance")," "),t.xp6(3),t.hij("",t.lcZ(26,44,"limits.limitTypes.user")," "),t.xp6(3),t.hij("",t.lcZ(29,46,"limits.limitTypes.eachUser")," "),t.xp6(3),t.hij("",t.lcZ(32,48,"limits.limitTypes.service")," "),t.xp6(3),t.hij("",t.lcZ(35,50,"limits.limitTypes.role")," "),t.xp6(3),t.hij("",t.lcZ(38,52,"limits.limitTypes.serviceByUser")," "),t.xp6(3),t.hij("",t.lcZ(41,54,"limits.limitTypes.serviceByEachUser")," "),t.xp6(3),t.hij("",t.lcZ(44,56,"limits.limitTypes.endpoint")," "),t.xp6(3),t.hij("",t.lcZ(47,58,"limits.limitTypes.endpointByUser")," "),t.xp6(3),t.hij("",t.lcZ(50,60,"limits.limitTypes.endpointByEachUser")," "),t.xp6(2),t.Q6J("ngIf",i.formGroup.controls.serviceId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.roleId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.userId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.endpoint),t.xp6(3),t.Oqu(t.lcZ(58,62,"limits.limitRate")),t.xp6(5),t.Oqu(t.lcZ(63,64,"limits.limitPeriod")),t.xp6(4),t.hij("",t.lcZ(67,66,"limits.limitPeriods.minute")," "),t.xp6(3),t.hij("",t.lcZ(70,68,"limits.limitPeriods.hour")," "),t.xp6(3),t.hij("",t.lcZ(73,70,"limits.limitPeriods.day")," "),t.xp6(3),t.hij("",t.lcZ(76,72,"limits.limitPeriods.week")," "),t.xp6(3),t.hij("",t.lcZ(79,74,"limits.limitPeriods.30Days")," "),t.xp6(4),t.Oqu(t.lcZ(83,76,"limits.active")),t.xp6(4),t.hij(" ",t.lcZ(87,78,"cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(90,80,"save")," "))},dependencies:[a.v,n.UX,n._Y,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,m.lN,m.KE,m.hX,l.c,l.Nt,g.LD,g.gD,h.ey,v.ax,h.Ng,v.O5,f.rP,f.Rr,c.ot,c.lW,A.Ot,O.M],styles:[".df-limit-form-container[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}"]}),d);C=(0,o.gn)([(0,y.c)({checkProperties:!0})],C)},41089:(E,_,r)=>{r.d(_,{v:()=>g});var o=r(65879),n=r(96814),u=r(32296),p=r(45597),c=r(90590);function f(l,m){if(1&l){const a=o.EpF();o.TgZ(0,"button",5),o.NdJ("click",function(){o.CHM(a);const A=o.oxw(2);return o.KtG(A.dismissAlert())}),o.TgZ(1,"fa-icon",6),o._uU(2),o.qZA()()}if(2&l){const a=o.oxw(2);o.xp6(1),o.Q6J("icon",a.faXmark),o.xp6(1),o.Oqu("alerts.close")}}function h(l,m){if(1&l&&(o.TgZ(0,"div",1),o._UZ(1,"fa-icon",2),o.TgZ(2,"span",3),o.Hsn(3),o.qZA(),o.YNc(4,f,3,2,"button",4),o.qZA()),2&l){const a=o.oxw();o.Tol(a.alertType),o.xp6(1),o.Q6J("icon",a.icon),o.xp6(3),o.Q6J("ngIf",a.dismissible)}}const v=["*"];let g=(()=>{class l{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new o.vpe,this.faXmark=c.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return c.f8k;case"error":return c.$9F;case"warning":return c.RLE;default:return c.sqG}}}return l.\u0275fac=function(a){return new(a||l)},l.\u0275cmp=o.Xpm({type:l,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[o.jDz],ngContentSelectors:v,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(a,T){1&a&&(o.F$t(),o.YNc(0,h,5,4,"div",0)),2&a&&o.Q6J("ngIf",T.showAlert)},dependencies:[n.O5,u.ot,u.RK,p.uH,p.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),l})()}}]);