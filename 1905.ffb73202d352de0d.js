"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[1905],{55799:(y,_,r)=>{r.d(_,{E:()=>I});var g,Z=r(97582),b=r(96814),a=r(56223),f=r(32296),s=r(17700),l=r(64170),c=r(2032),p=r(98525),m=r(42346),h=r(86806),S=r(30977),C=r(78791),x=r(26306),D=r(58504),t=r(65879);function G(i,o){1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"scripts.errors.githubImport")," "))}function T(i,o){1&i&&(t.TgZ(0,"mat-form-field")(1,"mat-label"),t._uU(2,"GitHub Username"),t.qZA(),t._UZ(3,"input",9),t.qZA())}function w(i,o){1&i&&(t.TgZ(0,"mat-form-field")(1,"mat-label"),t._uU(2,"GitHub Password"),t.qZA(),t._UZ(3,"input",10),t.qZA())}r(6625);let A=((g=class{constructor(o,e,n){this.githubService=o,this.formBuilder=e,this.dialogRef=n,this.isGitRepoPrivate=!1,this.formGroup=e.group({url:["",[a.kI.required,this.urlValidator]]})}ngOnInit(){this.formGroup.controls.url.valueChanges.subscribe(o=>{if(function U(i){let o;try{o=new URL(i)}catch{return!1}return"http:"===o.protocol||"https:"===o.protocol}(o)&&(o.indexOf(".js")>0||o.indexOf(".py")>0||o.indexOf(".php")>0||o.indexOf(".txt")>0)&&o.includes("github")){const n=o.substring(o.indexOf(".com/")+5).split("/");this.repoOwner=n[0],this.repoName=n[1],this.fileName=n[4],this.githubService.get(`${this.repoOwner}/${this.repoName}`,{snackbarError:"server",snackbarSuccess:"getScriptSuccessMsg",includeCacheControl:!1}).pipe((0,x.K)(d=>(this.isGitRepoPrivate=!0,this.formGroup.addControl("username",this.formBuilder.control("",a.kI.required)),this.formGroup.addControl("password",this.formBuilder.control("",a.kI.required)),(0,D._)(()=>new Error(d))))).subscribe(d=>{this.isGitRepoPrivate=d.private})}})}urlValidator(o){const e=o.value;return(e.indexOf(".js")>0||e.indexOf(".py")>0||e.indexOf(".php")>0||e.indexOf(".txt")>0)&&e.includes("github")?null:{invalidUrl:!0}}onFileUrlChange(o){console.log("file url changed",o)}onUpload(){if(this.formGroup.invalid)return;const o=`${this.repoOwner}/${this.repoName}/contents/${this.fileName}`,e=window.btoa(this.formGroup.value.username+":"+this.formGroup.value.password);this.githubService.get(o,{additionalParams:[{key:"ref",value:"main"}],additionalHeaders:[...this.isGitRepoPrivate?[{key:"Authorization",value:`Basic ${e}`}]:[]]}).subscribe(u=>{this.dialogRef.close({data:u})})}}).\u0275fac=function(o){return new(o||g)(t.Y36(h.mx),t.Y36(a.qu),t.Y36(s.so))},g.\u0275cmp=t.Xpm({type:g,selectors:[["df-scripts-github-dialog"]],standalone:!0,features:[t.jDz],decls:18,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-section",3,"formGroup"],["subscriptSizing","dynamic"],["matInput","","formControlName","url","placeholder","https://github.com/user/repo/blob/file.json"],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],["matInput","","formControlName","username","placeholder","Username","type","text"],["matInput","","formControlName","password","placeholder","Password","type","password"]],template:function(o,e){1&o&&(t.TgZ(0,"h1",0),t._uU(1,"Import a script file from GitHub"),t.qZA(),t.TgZ(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),t._uU(6,"GitHub File URL"),t.qZA(),t._UZ(7,"input",4),t.YNc(8,G,3,3,"mat-error",5),t.qZA(),t.YNc(9,T,4,0,"mat-form-field",5),t.YNc(10,w,4,0,"mat-form-field",5),t.qZA()(),t.TgZ(11,"div",6)(12,"button",7),t._uU(13),t.ALo(14,"transloco"),t.qZA(),t.TgZ(15,"button",8),t.NdJ("click",function(){return e.onUpload()}),t._uU(16),t.ALo(17,"transloco"),t.qZA()()),2&o&&(t.xp6(3),t.Q6J("formGroup",e.formGroup),t.xp6(5),t.Q6J("ngIf",null==e.formGroup.controls.url.errors?null:e.formGroup.controls.url.errors.invalidUrl),t.xp6(1),t.Q6J("ngIf",e.formGroup.contains("username")),t.xp6(1),t.Q6J("ngIf",e.formGroup.contains("password")),t.xp6(3),t.Oqu(t.lcZ(14,6,"close")),t.xp6(3),t.hij(" ",t.lcZ(17,8,"upload")," "))},dependencies:[f.ot,f.lW,s.Is,s.ZT,s.uh,s.xY,s.H8,l.lN,l.KE,l.hX,l.TO,c.c,c.Nt,a.UX,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,b.O5,m.Ot]}),g);A=(0,Z.gn)([(0,C.c)({checkProperties:!0})],A);var v,P=r(41609),E=r(94664),O=r(23680);function J(i,o){if(1&i&&(t.TgZ(0,"mat-option",11),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.label," ")}}function V(i,o){if(1&i&&(t.TgZ(0,"mat-form-field",5)(1,"mat-label"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"input",12),t.qZA()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"path")),t.xp6(2),t.Q6J("formControl",e.storagePath)}}function N(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(e);const u=t.oxw(2);return t.KtG(u.deleteCache())}),t._uU(1),t.ALo(2,"transloco"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"scripts.deleteCache")," "))}function R(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",13)(1,"button",14),t.NdJ("click",function(){t.CHM(e);const u=t.oxw();return t.KtG(u.viewLatest())}),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t.YNc(4,N,3,3,"button",15),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("disabled",!e.storagePath.getRawValue()),t.xp6(1),t.hij(" ",t.lcZ(3,3,"scripts.viewLatest")," "),t.xp6(2),t.Q6J("ngIf",e.cache)}}let I=((v=class{constructor(o,e,n,u){this.dialog=o,this.fileService=e,this.cacheService=n,this.baseService=u,this.storageServices=[],this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(d=>{this.storageServices=d.services})}ngOnInit(){this.storageServiceId.getRawValue()&&this.storagePath.addValidators([a.kI.required]),this.storageServiceId.valueChanges.subscribe(o=>{this.storagePath.reset(),o?(this.storagePath.addValidators([a.kI.required]),this.content.reset(),this.content.disable()):this.storagePath.hasValidator(a.kI.required)&&(this.content.enable(),this.storagePath.removeValidators([a.kI.required])),this.storagePath.updateValueAndValidity()})}fileUpload(o){const e=o.target;e.files&&(0,S.Vu)(e.files[0]).subscribe(n=>{this.content.setValue(n)})}githubImport(){this.dialog.open(A).afterClosed().subscribe(e=>{e&&this.content.setValue(window.atob(e.data.content))})}viewLatest(){const o=`${this.storageServices.find(e=>e.id===this.storageServiceId.getRawValue())?.name}/${this.storagePath.getRawValue()}`;o.endsWith(".json")?this.fileService.downloadJson(o).subscribe(e=>this.content.setValue(e)):this.fileService.downloadFile(o).pipe((0,E.w)(e=>(0,S.Vu)(e))).subscribe(e=>this.content.setValue(e))}deleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}}).\u0275fac=function(o){return new(o||v)(t.Y36(s.uw),t.Y36(h.PA),t.Y36(h.OP),t.Y36(h.PA))},v.\u0275cmp=t.Xpm({type:v,selectors:[["df-script-editor"]],inputs:{cache:"cache",type:"type",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[t.jDz],decls:20,vars:18,consts:[[1,"details-section"],[1,"actions","full-width"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],["subscriptSizing","dynamic",1,"dynamic-width"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["class","dynamic-width","subscriptSizing","dynamic",4,"ngIf"],["class","actions",4,"ngIf"],[1,"full-width",3,"formControl","readonly","mode"],[3,"value"],["matInput","",3,"formControl"],[1,"actions"],["mat-flat-button","","color","primary","type","button",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),t.NdJ("change",function(d){return e.fileUpload(d)}),t.qZA(),t.TgZ(4,"button",4),t.NdJ("click",function(){t.CHM(n);const d=t.MAs(3);return t.KtG(d.click())}),t._uU(5),t.ALo(6,"transloco"),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){return e.githubImport()}),t._uU(8),t.ALo(9,"transloco"),t.qZA()(),t.TgZ(10,"mat-form-field",5)(11,"mat-label"),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"mat-select",6),t._UZ(15,"mat-option"),t.YNc(16,J,2,2,"mat-option",7),t.qZA()(),t.YNc(17,V,5,4,"mat-form-field",8),t.YNc(18,R,5,5,"div",9),t._UZ(19,"df-ace-editor",10),t.qZA()}2&o&&(t.xp6(4),t.Q6J("disabled",e.storageServiceId.getRawValue()),t.xp6(1),t.hij(" ",t.lcZ(6,12,"desktopFile")," "),t.xp6(2),t.Q6J("disabled",e.storageServiceId.getRawValue()),t.xp6(1),t.hij(" ",t.lcZ(9,14,"githubFile")," "),t.xp6(4),t.Oqu(t.lcZ(13,16,"service")),t.xp6(2),t.Q6J("formControl",e.storageServiceId),t.xp6(2),t.Q6J("ngForOf",e.storageServices),t.xp6(1),t.Q6J("ngIf",!!e.storageServiceId.getRawValue()),t.xp6(1),t.Q6J("ngIf",e.storageServiceId.getRawValue()),t.xp6(1),t.Q6J("formControl",e.content)("readonly",!!e.storageServiceId.getRawValue())("mode",e.type.getRawValue()))},dependencies:[f.ot,f.lW,m.Ot,b.O5,l.lN,l.KE,l.hX,p.LD,p.gD,O.ey,b.ax,s.Is,c.c,c.Nt,P.C,a.UX,a.Fj,a.JJ,a.oH],styles:[".actions[_ngcontent-%COMP%]{display:flex;gap:16px}"]}),v);I=(0,Z.gn)([(0,C.c)({checkProperties:!0})],I)},15711:(y,_,r)=>{r.d(_,{H:()=>a,p:()=>b});var Z=r(94517);function b(f){return Object.values((0,Z.sh)(f)).flatMap(s=>Object.entries(s).map(([l,c])=>{let p=[];return p=c.parameter?c.endpoints.flatMap(m=>{const h=m.match(/{(.*?)}/);if(h){const S=h[1];return[m,...(c.parameter?.[S]||[]).map(x=>m.replace(`{${S}}`,x))]}return m}):c.endpoints,{name:l,endpoints:[...new Set(p)]}}))}function a(f){const s=[],l=new Set;for(const c of f){const p=c.split(".")[0];l.has(p)||(l.add(p),s.push(`${p}.*`)),s.push(c)}return s}}}]);